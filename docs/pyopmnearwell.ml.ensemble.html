<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyopmnearwell.ml.ensemble module &mdash; pyopmnearwell  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyopmnearwell.ml.integration module" href="pyopmnearwell.ml.integration.html" />
    <link rel="prev" title="pyopmnearwell.ml.data module" href="pyopmnearwell.ml.data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #aaaaaa" >

          
          
          <a href="index.html">
            
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_file.html">Configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">pyopmnearwell Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_folder.html">Output folder</a></li>
<li class="toctree-l1"><a class="reference internal" href="related.html">Related</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About pyopmnearwell</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #aaaaaa" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyopmnearwell</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="api.html">pyopmnearwell Python API</a></li>
          <li class="breadcrumb-item"><a href="pyopmnearwell.html">pyopmnearwell package</a></li>
          <li class="breadcrumb-item"><a href="pyopmnearwell.ml.html">pyopmnearwell.ml package</a></li>
      <li class="breadcrumb-item active">pyopmnearwell.ml.ensemble module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pyopmnearwell.ml.ensemble.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-pyopmnearwell.ml.ensemble">
<span id="pyopmnearwell-ml-ensemble-module"></span><h1>pyopmnearwell.ml.ensemble module<a class="headerlink" href="#module-pyopmnearwell.ml.ensemble" title="Link to this heading"></a></h1>
<p>“Run high-fidelity nearwell simulations in OPM-Flow for an ensemble of varying input
arguments.</p>
<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.calculate_WI">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">calculate_WI</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runspecs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_zcells</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.calculate_WI" title="Link to this definition"></a></dt>
<dd><p>Calculate the well index (WI) for a given dataset.</p>
<p>The well index (WI) is calculated using the following formula:</p>
<div class="math notranslate nohighlight">
\[WI = \frac{q}{{p_w - p_{gb}}}\]</div>
<p>Note: In 3D this will more probably than not fail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Data generated by <code class="docutils literal notranslate"><span class="pre">run_ensemble</span></code>.</p></li>
<li><p><strong>runspecs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Must contain a key “INJECTION_RATE_PER_SECOND”. Unit</p></li>
<li><p><strong>[</strong><strong>m^3/s</strong><strong>]</strong><strong>.</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">shape=(,num_cells</span> <span class="pre">-</span> <span class="pre">1)</span></code></dt><dd><p>An array of well index values for each data point in the dataset. In the
correct unit for OPM. Unit [m^4*s/kg].</p>
</dd>
</dl>
<p>failed_indices (list[int]): Indices for the ensemble members where WI could not
be computed. E.g., if the simmulation went wrong and the pressure difference is
zero.</p>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>WI_array (numpy.ndarray)</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If no data is found for the ‘pressure’ keyword in the dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.calculate_radii">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">calculate_radii</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gridfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_cells</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_outer_inner</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">triangle_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0471975511965976</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">np.ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">np.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">np.ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.calculate_radii" title="Link to this definition"></a></dt>
<dd><p>Calculates the radii of the cells in a grid grom a given .</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gridfile</strong> (<em>str</em><em> | </em><em>pathlib.Path</em>) – Path to the file containing the grid.</p></li>
<li><p><strong>num_cells</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cells in the grid. Defaults to 400.</p></li>
<li><p><strong>num_dims</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of dimensions of the grid. Defaults to 1.</p></li>
<li><p><strong>return_outer_inner</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to return the inner and outer radii
in addition to the average radii. Defaults to False.</p></li>
<li><p><strong>triangle_grid</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether the grid is a triangle grid. If
True, transform altitudes of the triangle grid to radii of a raidal grid
with equal solution. Defaults to False.</p></li>
<li><p><strong>theta</strong> (<em>float</em><em>, </em><em>optional</em>) – Angle between the horizontal axis and the edge of the
triangle grid. Defaults to <code class="docutils literal notranslate"><span class="pre">math.pi/3</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl>
<dt>If return_outer_inner is</dt><dd><p>False, returns an array of the average radii of the cells.</p>
<p>If return_outer_inner is True, returns a tuple containing the array of
average radii, the array of inner radii, and the array of outer radii.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray | tuple[np.ndarray, np.ndarray, np.ndarray]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – If the number of lines in the grid file is not equal to
    num_cells + 1.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.create_ensemble">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">create_ensemble</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">runspecs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">efficient_sampling</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.create_ensemble" title="Link to this definition"></a></dt>
<dd><p>Create an ensemble.</p>
<p>Note: It is assumed that the user provides the variables in the correct units for
pyopmnearwell.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>runspecs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – <p>Dictionary with at least the following keys:
- “npoints”: Maximum number of ensemble members.
- “variables”: <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing the run Args vary within the</p>
<blockquote>
<div><p>ensemble. The key specifies the variable name (needs to be identical to
the variable name in the <code class="docutils literal notranslate"><span class="pre">*.mako</span></code> file that is passed to
<code class="docutils literal notranslate"><span class="pre">setup_ensemble</span></code>) and the value is a tuple <code class="docutils literal notranslate"><span class="pre">(min,</span> <span class="pre">max,</span> <span class="pre">npoints)</span></code> with
the min. and max. values for the variable and the number of samples
generated for this variable. The samples are taken from a uniform
distribution in the interval <span class="math notranslate nohighlight">\([min, max]\)</span>.</p>
</div></blockquote>
<ul>
<li><p>”constants”: <code class="docutils literal notranslate"><span class="pre">dict</span></code> containing the run Args that are constant for
all ensemble members.</p></li>
</ul>
</p></li>
<li><p><strong>efficient_sampling</strong> (<em>Optional</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – List containing the names of
variables that should be sampled instead of fully meshed and then sampled.
This is faster and avoids memory overload for higher dimensional
combinations of variables. E.g., when creating an ensemble with varying
vertical permeabilities. Only 10 layers with 10 samples generate a grid of
10^10 values. By sampling directly instead of generating the grid first, it
is possible to deal with the complexity.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Note: The ensemble is generated as the cartesian product of all variable ranges. The</dt><dd><p>total number of ensemble members is thus the product of all individual
<code class="docutils literal notranslate"><span class="pre">npoints</span></code>. If <code class="docutils literal notranslate"><span class="pre">runspecs[&quot;npoints&quot;]</span></code> is lower than the product, a random
sample of size <code class="docutils literal notranslate"><span class="pre">runspecs[&quot;npoints&quot;]</span></code> of the full ensemble is returned.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>List containing a dict with the specified</dt><dd><p>variable values for each ensemble member.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ensemble (list[dict[str, Any]])</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If <code class="docutils literal notranslate"><span class="pre">runspecs[&quot;npoints&quot;]</span></code> is larger than the number of generated
    ensemble members.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.extract_features">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">extract_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keywords</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword_scalings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.extract_features" title="Link to this definition"></a></dt>
<dd><p>Extract features into a numpy array.</p>
<p>Note: The features are in the units used in <code class="docutils literal notranslate"><span class="pre">*.UNRST</span></code> and <code class="docutils literal notranslate"><span class="pre">*.SMSPEC</span></code> files. The
user is responsible for transforming them to the units needed. This may depend on
various factors such as the mode OPM will run in. In particular, pressure is in
[bar].
Some units for common quantities:
- Pressure: [bar]
- Temperate: [°C]
- Saturation: [unitless]
- Time: []</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Data generated by <code class="docutils literal notranslate"><span class="pre">run_ensemble</span></code>.</p></li>
<li><p><strong>keywords</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – Keywords to extract. The features will be in the order of</p></li>
<li><p><strong>keywords.</strong> (<em>the</em>) – </p></li>
<li><p><strong>keyword_scalings</strong> (<em>Optional</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>float</em><em>]</em><em>]</em>) – Scalings for the features.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>(numpy.ndarray): <code class="docutils literal notranslate"><span class="pre">shape=(,num_cells</span> <span class="pre">-</span> <span class="pre">1)</span></code></dt><dd><p>An array of input features each data point in the dataset.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>feature_array</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If no data is found for the ‘pressure’ keyword in the dataset.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.integrate_fine_scale_value">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">integrate_fine_scale_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radial_values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radii</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_sidelength</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.integrate_fine_scale_value" title="Link to this definition"></a></dt>
<dd><p>Integrate a fine scale value across all radial cells lying in a square grid
block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>radial_values</strong> (<em>np.ndarray</em>) – Cell values for the radial cells.</p></li>
<li><p><strong>radii</strong> (<em>np.ndarray</em>) – Array of radii for inner and outer radius of the radial</p></li>
<li><p><strong>cells.</strong> – </p></li>
<li><p><strong>block_sidelength</strong> (<em>float</em>) – The sidelength of the square grid block.</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Axis to integrate along.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The integrated value of fine-scale data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.memory_efficient_sample">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">memory_efficient_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_members</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.memory_efficient_sample" title="Link to this definition"></a></dt>
<dd><p>Sample all variables individually.</p>
<p>Note: Requires that all variables arrays have the same length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variables</strong> (np.ndarray), (<code class="docutils literal notranslate"><span class="pre">shape=(num_variables,</span> <span class="pre">len_variables)</span></code>) – _description_</p></li>
<li><p><strong>num_members</strong> (<em>int</em>) – _description_</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>np.ndarray (<code class="docutils literal notranslate"><span class="pre">shape=()</span></code>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.run_ensemble">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">run_ensemble</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flow_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runspecs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ecl_keywords</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_keywords</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">summary_keywords</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_report_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.run_ensemble" title="Link to this definition"></a></dt>
<dd><p>Run OPM flow for each ensemble member and store data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flow_path</strong> (<em>_type_</em>) – _description_</p></li>
<li><p><strong>ensemble_path</strong> (<em>pathlib.Path</em>) – _description_</p></li>
<li><p><strong>runspecs</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – _description_</p></li>
<li><p><strong>ecl_keywords</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – _description_</p></li>
<li><p><strong>init_keywords</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – _description_</p></li>
<li><p><strong>summary_keywords</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – _description_</p></li>
<li><p><strong>num_report_steps</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em><em>, </em><em>optional</em>) – Disregard an ensemble simulation, if
it did not run to the last report step. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>_description_</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.setup_ensemble">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">setup_ensemble</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">makofile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recalc_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recalc_tables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recalc_sections</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.setup_ensemble" title="Link to this definition"></a></dt>
<dd><p>Create a deck file for each ensemble member.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ensemble_path</strong> (<em>pathlib.Path</em>) – The path to the ensemble directory.</p></li>
<li><p><strong>ensemble</strong> (<em>list</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – A list of dictionaries containing the
parameters for each ensemble member. Usually generated by
<code class="docutils literal notranslate"><span class="pre">create_ensemble</span></code>.</p></li>
<li><p><strong>makofile</strong> (<em>str</em><em> | </em><em>pathlib.Path</em>) – The path to the Mako template file for the
pyopmnearwell deck for ensemble members.</p></li>
<li><p><strong>recalc_grid</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to recalculate <code class="docutils literal notranslate"><span class="pre">GRID.INC</span></code> for each
ensemble member. Defaults to False.</p></li>
<li><p><strong>recalc_tables</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to recalculate <code class="docutils literal notranslate"><span class="pre">TABLES.INC</span></code> for each
ensemble member. Defaults to False.</p></li>
<li><p><strong>recalc_sections</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to recalculate <code class="docutils literal notranslate"><span class="pre">GEOLOGY.INC</span></code> and
<code class="docutils literal notranslate"><span class="pre">REGIONS.INC</span></code> for each ensemble member. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If there is an error rendering the Mako template.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pyopmnearwell.ml.ensemble.store_dataset">
<span class="sig-prename descclassname"><span class="pre">pyopmnearwell.ml.ensemble.</span></span><span class="sig-name descname"><span class="pre">store_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">np.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">np.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">pathlib.Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pathlib.Path</span></span></span><a class="headerlink" href="#pyopmnearwell.ml.ensemble.store_dataset" title="Link to this definition"></a></dt>
<dd><p>Store a TensorFlow dataset given by to tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>features</strong> (<em>np.ndarray</em>) – Features of the dataset.</p></li>
<li><p><strong>targets</strong> (<em>np.ndarray</em>) – Targets of the dataset.</p></li>
<li><p><strong>savepath</strong> (<em>str</em><em> | </em><em>pathlib.Path</em>) – Folder where the dataset should be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Savepath of the dataset</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pathlib.Path</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pyopmnearwell.ml.data.html" class="btn btn-neutral float-left" title="pyopmnearwell.ml.data module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pyopmnearwell.ml.integration.html" class="btn btn-neutral float-right" title="pyopmnearwell.ml.integration module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NORCE Norwegian Research Centre AS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>