<%
import math as mt
import numpy as np
%>-- Copyright (C) 2023-2025, NORCE Research AS
-- This deck was generated by pyopmnearwell https://github.com/cssr-tools/pyopmnearwell
----------------------------------------------------------------------------
RUNSPEC
----------------------------------------------------------------------------
DIMENS 
% if dic['grid']=='core':
${dic['nocells'][0]} ${dic['nocells'][1]} ${dic['nocells'][2]} /
% else:
${max(dic['nocells'][0],dic['nocells'][1])} ${dic['nocells'][1]} ${dic['nocells'][2]} /
% endif

WATER
GAS
BRINE
PRECSALT
VAPWAT
CO2STORE
DISGASW

METRIC

START
1 JAN 2000 /
% if dic['grid']=='radial':

RADIAL
% endif

EQLDIMS
/

TABDIMS
${f"{(1*(dic['hysteresis']!=0)+1)*(dic['satnum']+dic['perforations'][0])} /" if (1*(dic["hysteresis"]!=0)+1)*(dic['satnum']+dic['perforations'][0])>1 else "/"}
% if dic["hysteresis"]!=0:

SATOPTS
HYSTER /
% endif

WELLDIMS
${dic['nocells'][2]} ${dic['nocells'][2]} 1 ${dic['nocells'][2]} /

UNIFOUT
----------------------------------------------------------------------------
GRID
----------------------------------------------------------------------------
% if dic['write']==1:
INIT
% else:
GRIDFILE 
0 0 /
% endif
% if dic["fluxnum"]:

INCLUDE
FLUXNUM.INC /
% endif

INCLUDE
GEOLOGY.INC /
% if dic["pvmult"]>0:
----------------------------------------------------------------------------
EDIT
----------------------------------------------------------------------------
INCLUDE
MULTPV.INC /
% endif
----------------------------------------------------------------------------
PROPS
----------------------------------------------------------------------------
INCLUDE
TABLES.INC /
% if dic["hysteresis"]!=0:

EHYSTR
1* ${0 if dic["hysteresis"].upper()=="CARLSON" else 2} 2* BOTH /
% endif

SALTSOL
${dic['saltprops'][1]} ${dic['saltprops'][2]}/
/

% if dic["rockcomp"]>0:
ROCK
276 ${dic["rockcomp"]} /
% endif

INCLUDE
PERMFACT.INC /

% if dic["pcfact"]>0:
INCLUDE
PCFACT.INC /
% endif
% if dic["hysteresis"]!=0 or dic["fluxnum"]:
----------------------------------------------------------------------------
REGIONS
----------------------------------------------------------------------------
% if dic["hysteresis"]!=0 and dic["fluxnum"]:
COPY
FLUXNUM SATNUM /
FLUXNUM IMBNUM /
/

ADD
IMBNUM ${len(dic["rock"])} /
/
% elif dic["fluxnum"]:
COPY
FLUXNUM SATNUM /
/
% else:
IMBNUM
${dic['nocells'][0]*dic['nocells'][1]*dic['nocells'][2]}*2 /
% endif
% endif
----------------------------------------------------------------------------
SOLUTION
----------------------------------------------------------------------------
EQUIL
0 ${dic['pressure']} ${mt.floor(dic["initialphase"]*dic['dims'][2])} 0 0 0 1 1 0 /

SALTVD
${"".join([' ' for _ in range(len(str(dic['dims'][2]))-1)])}0 ${dic['saltprops'][0]}
${dic['dims'][2]} ${dic['saltprops'][0]} /

RTEMPVD
${"".join([' ' for _ in range(len(str(dic['dims'][2]))-1)])}0 ${dic['temperature'][0]}
${dic['dims'][2]} ${dic['temperature'][1]} /
% if dic['write']==1:

RPTRST 
BASIC=2 DEN RPORV /
% endif
----------------------------------------------------------------------------
SUMMARY
----------------------------------------------------------------------------
PERFORMA
FPR
FWIP
FGMIP
FGMIR
FGMIT
FGMGP
FGMDS
WGMIR
/
WGMIT
/
RPR
/
RGMIP
/
RGMDS
/
RGMGP
/
RWIP
/
WBHP
/
WPI
/
----------------------------------------------------------------------------
SCHEDULE
----------------------------------------------------------------------------
% if dic['write']==1:
RPTRST
BASIC=2 DEN RPORV /
% endif

WELSPECS
% if dic['grid']=='core':
INJ0 G1 1 ${1+mt.floor(dic['nocells'][2]/2)} 1* ${'GAS' if dic['inj'][0][2]>0 else 'WATER'} 3* ${'NO' if dic["xflow"]>0 else ''} /
% else:
% for i in range(dic['nocells'][2]):
INJ${i} G1 ${max(1, 1+mt.floor(dic['nocells'][1]/2))} ${max(1, 1+mt.floor(dic['nocells'][1]/2))} 1* ${'GAS' if dic['inj'][0][2]>0 else 'WATER'} 3* ${'NO' if dic["xflow"]>0 else ''} /
% endfor
% endif
% if dic["pvmult"]==0 or dic['grid']=='core':
% if dic['grid']=='core':
PRO0 G1 ${dic['nocells'][0]} ${1+mt.floor(dic['nocells'][2]/2)} 1* WATER /
% elif dic['grid'] != 'cartesian' and dic['grid'] != 'tensor3d' and dic['grid'] != 'coord3d' and dic['grid'] != 'cpg3d':
PRO0 G1 ${dic['nocells'][0]} 1 1* WATER /
% else:
PRO0 G1 1 1 1* WATER /
PRO1 G1 ${dic['nocells'][0]} 1 1* WATER /
PRO2 G1 1 ${dic['nocells'][0]} 1* WATER /
PRO3 G1 ${dic['nocells'][0]} ${dic['nocells'][0]} 1* WATER /
% endif
% endif
/
COMPDAT
% if dic["confact"]==0:
% if dic['grid']=='core':
INJ0 1 ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} OPEN 2* ${dic['diameter']} /
% else:
% for i in range(dic['nocells'][2]):
INJ${i} ${max(1, 1+mt.floor(dic['nocells'][1]/2))} ${max(1, 1+mt.floor(dic['nocells'][1]/2))} ${i+1} ${i+1} OPEN 2* ${dic['diameter']} /
% endfor
% endif
% else:
% if dic['grid']=='core':
INJ0 1 ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} OPEN 1* ${dic["confact"]} /
% else:
% for i in range(dic['nocells'][2]):
INJ${i} ${max(1, 1+mt.floor(dic['nocells'][1]/2))} ${max(1, 1+mt.floor(dic['nocells'][1]/2))} ${i+1} ${i+1} OPEN 1* ${dic["confact"]*2*mt.pi*dic['rock'][int(dic["layers"][i])][0]*dic['dims'][2]/dic['nocells'][2]} /
% endfor
% endif
% endif
% if dic["pvmult"]==0 or dic['grid']=='core':
% if dic['grid']=='core':
PRO0 ${dic['nocells'][0]} ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} ${1+mt.floor(dic['nocells'][2]/2)} OPEN 1* ${dic["confact"]} /
% elif dic['grid'] != 'cartesian' and dic['grid'] != 'tensor3d' and dic['grid'] != 'coord3d' and dic['grid'] != 'cpg3d':
PRO0 ${dic['nocells'][0]} 1 1 ${0*dic['nocells'][2]+1} OPEN 2* ${dic['diameter']} /
% else:
PRO0 1 1 1 ${0*dic['nocells'][2]+1} OPEN 2* ${dic['diameter']} /
PRO1 ${dic['nocells'][0]} 1 1 ${0*dic['nocells'][2]+1} OPEN 2* ${dic['diameter']} /
PRO2 1 ${dic['nocells'][0]} 1 ${0*dic['nocells'][2]+1} OPEN 2* ${dic['diameter']} /
PRO3 ${dic['nocells'][0]} ${dic['nocells'][0]} 1 ${0*dic['nocells'][2]+1} OPEN 2* ${dic['diameter']} /
% endif
% endif
/
% for j in range(len(dic['inj'])):

% if dic["tuning"]:
TUNING
${dic['inj'][j][4]+" " if len(dic['inj'][j])>4 else ""}/
${dic['inj'][j][5]+" " if len(dic['inj'][j])>5 else ""}/
${dic['inj'][j][6]+" " if len(dic['inj'][j])>6 else ""}/
% endif
WCONINJE
% for i in range(dic['nocells'][2]):
% if dic['inj'][j][2]>0:
INJ${i} GAS ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} RATE ${f"{dic['inj'][j][3] / (dic['nocells'][2]*1.86843):E}"} 1* 480 /
% else:
INJ${i} WATER ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} RATE ${f"{dic['inj'][j][3] / (dic['nocells'][2]*998.108):E}"} 1* 480 /
% endif
% endfor
/
% if dic["pvmult"]==0 or dic['grid']=='core': 
WCONPROD
% if dic['grid']=='cartesian' or dic['grid']=='tensor3d' or dic['grid']=='coord3d' or dic['grid']=='cpg3d':
PRO0 ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} BHP 5* ${dic['pressure']} /
PRO1 ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} BHP 5* ${dic['pressure']} /
PRO2 ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} BHP 5* ${dic['pressure']} /
PRO3 ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} BHP 5* ${dic['pressure']} /
% else:
PRO0 ${'OPEN' if dic['inj'][j][3]>0 else 'SHUT'} BHP 5* ${dic['pressure']} /
% endif
/
% endif
TSTEP
${f"{round(dic['inj'][j][0]/dic['inj'][j][1])}*" if round(dic['inj'][j][0]/dic['inj'][j][1])>1 else ""}${dic['inj'][j][1]} /
% endfor